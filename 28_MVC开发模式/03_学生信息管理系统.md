## 学生信息管理系统

### 需求

页面上完成学生数据的展示, 可进行学生信息的增删改差, 可以的话, 支持上一页, 下一页操作, 以及学生信息查询



### 分析

所应用的技术点: 

1. Tomcat server
2. Servlet
3. jsp 页面
4. Mysql数据库
5. 数据库操作: SpringJDBC + Druid连接池
6. BeanUtils: 完成数据封装 (反序列化)



### 实现

#### 一. 表结构设计

+ 创建数据库: student

  将编码设置为 utf-8, 便于存取中文

  ```sql
  drop database if exists student;
  create database student default charset=utf8;
  ```

+ 创建表: student

  ```sql
  create table student(
      id int unsigned primary key auto_increment not null,
      student_id varchar(20) not null unique COMMENT '学号',
      name varchar(20) not null,
      gender varchar(5),
      birthday date, 
      address varchar(50),
      qq varchar(20),
      email varchar(50)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
  ```

  > 设置student_id的原因是因为学号可能会改变, 而主键 id 无法修改.



#### 二. 创建JavaEE项目, 导入 jar 包

项目结构图如下: 

![1575084840063](03_学生信息管理系统.assets/1575084840063.png).

#### 三. 准备前端页面 (原型设计)

在项目中就是前端的 html 代码, 这一步也非常的重要.

> 首页展示学生信息, 查询还是在首页进行
>
> 新增, 修改信息页面
>
> 删除提示框 ? ( 要不要提示用户是否删除呢, 按道理是需要的, 先不做, 留到优化部分吧 )

所以, 就两个页面 ~ 

##### 学生信息列表

![1575172080588](03_学生信息管理系统.assets/1575172080588.png)

##### 编辑页面

![1575172105036](03_学生信息管理系统.assets/1575172105036.png)



#### 四. 代码层次结构

代码模块的划分:

1. 实体类: student  (就一张学生表, 所以对应的实体类只有一个)
2. 数据访问对象: dao  (操作学生对象的 StudentDao)
3. 逻辑处理: Servlet  (学生信息列表展示, 新增学生信息, 修改学生信息, 删除学生信息)
4. 工具类: JDBCDruidUtils  (封装了 SpringJDBC 对数据库的操作)
5. 单元测试: test

在 src 目录下创建代码的层次结构:

![1575173238766](03_学生信息管理系统.assets/1575173238766.png).



#### 五. 具体逻辑实现

##### JDBCDruidUtils 连接池:

```java
package com.student.utils;

import com.alibaba.druid.pool.DruidDataSourceFactory;
import javax.sql.DataSource;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Properties;

/**
 * JDBCDruidUtils 工具类
 */
public class JDBCDruidUtils {
    private static DataSource ds = null;

    static {
        try {
            // 加载配置文件
            Properties pro = new Properties();
            // 获取 src 路径下的文件 --> ClassLoader
            ClassLoader cl = JDBCDruidUtils.class.getClassLoader();
            InputStream is = cl.getResourceAsStream("druid.properties");
            pro.load(is);
            // 通过工厂函数 获取 数据库连接池 (传入配置文件)
            ds = DruidDataSourceFactory.createDataSource(pro);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // 获取连接池对象
    public static DataSource getDataSource(){
        return ds;
    }

    // 获取连接对象
    public static Connection getConnection() throws SQLException {
        return ds.getConnection();
    }
}
```

##### druid.properties 配置文件

```properties
driverClassName=com.mysql.jdbc.Driver
# useUnicode表示允许使用自定义的Unicode
url=jdbc:mysql://192.168.0.115:3306/JDBC?useUnicode=true&characterEncoding=utf8
username=username
password=password
initialSize=5
maxActive=10
maxWait=3000
```



##### student 实体类

```java
package com.student.entity;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class Student {
    private int id;
    private String studentId;
    private String name;
    private String gender;
    private Date birthday;
    private String address;
    private String qq;

    // setter and getter ,  日期类型需要额外转换下
    
    public String getBirthday() {
        SimpleDateFormat formater = new SimpleDateFormat("yyyy-MM-dd");
        return formater.format(this.birthday);
    }

    public void setBirthday(String birthday) {
        SimpleDateFormat formater = new SimpleDateFormat("yyyy-MM-dd");
        Date date = null;
        try {
            date = formater.parse(birthday);
        } catch (ParseException e) {
            e.printStackTrace();
        }
        this.birthday = date;
    }
}

```



##### studentDao

```java

```



##### list

```java
package com.student.servlet;

import com.student.utils.JDBCDruidUtils;
import org.springframework.jdbc.core.JdbcTemplate;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.sql.DataSource;
import java.io.IOException;
import java.util.List;
import java.util.Map;

@WebServlet("/list")
public class ReadList extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // 不用获取参数, 所以不用设置流的编码
            // 获取 JdbcTemplate 对象
        DataSource ds  = JDBCDruidUtils.getDataSource();
        JdbcTemplate template = new JdbcTemplate(ds);

        // 查询结果, 将结果集封装为 ReadList 集合
//        String querySql = "select * from student limit 0, 3";
        String querySql = "select * from student";
        java.util.List<Map<String, Object>> studentList = template.queryForList(querySql);
        // 将学生对象列表存储到 request 对象域中
        request.setAttribute("studentList", studentList);
        // 转发到 list 页面
        request.getRequestDispatcher("/list.jsp").forward(request, response);
    }
}

```



##### create

```java
package com.student.servlet;

import com.student.dao.StudentDao;
import com.student.entity.Student;
import java.io.IOException;
import java.util.Map;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/create")
public class Create extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // 获取参数, 设置流的编码
        request.setCharacterEncoding("utf-8");
        // 将参数封装到 map 集合中 (使用JavaBeanUtils工具)
        Map<String, String[]> map = request.getParameterMap();
        Student student = StudentDao.mapToStudent(map);

        // 获取 JdbcTemplate 对象, 将学生信息写入到数据库中
        int num = StudentDao.create(student);
        // 重定向到 list 页面
        response.sendRedirect(request.getContextPath() + "/list");
    }
}

```



##### update









servlet/create

存储中文到数据库显示乱码 (??), 需要修改 druid.properties 中的编码: 

```
url=jdbc:mysql://192.168.0.115:3306/JDBC?useUnicode=true&characterEncoding=utf8
...
```



 实现类





Student JavaBean

